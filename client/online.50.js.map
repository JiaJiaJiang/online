{"version":3,"names":[],"mappings":"","sources":["online.js"],"sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n'use strict';(function(){function randomUser(){return conv(Math.round(99999999*Math.random()),10,62)}function conv(n,o,t,olist,tlist){var m,_Mathfloor=Math.floor,_Mathpow=Math.pow,tnum=[],negative=\"-\"==(n+=\"\").trim()[0],decnum=0;olist||(olist=\"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"),tlist||(tlist=\"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"),negative&&(n=n.slice(1));for(var i=n.length;i--;)decnum+=olist.indexOf(n[i])*_Mathpow(o,n.length-i-1);for(;0!=decnum;tnum.unshift(tlist[m]))m=decnum%t,decnum=_Mathfloor(decnum/t);return decnum&&tnum.unshift(tlist[decnum]),(negative?\"-\":\"\")+tnum.join(\"\")}class Online{constructor(addr){if(this.addr=addr,this.groups=new Set,this.on=!1,this.waiting=!1,this.onOnlineChange=null,this.onData=null,this.onConnected=null,this.pinger=setInterval(()=>{this.opened&&this.ws.send(\"\")},25e3),this.user=`${conv(Date.now(),10,62)}-${randomUser()}`,this.ws=null,this.subscribing=!1,window.localStorage){var user=localStorage.getItem(\"online_user\");user?this.user=user:localStorage.setItem(\"online_user\",this.user)}addr&&(this.on=!0,this.connet())}get opened(){return this.ws&&1===this.ws.readyState}get connected(){return this.ws.connected}send(data){this.ws.send(JSON.stringify(data))}enter(name){if(\"string\"!=typeof name)throw\"name is not a string:\"+name;return this.groups.add(name),this.connected&&this.send({_:\"enter\",g:name,u:this.user}),this}leave(name){if(\"string\"!=typeof name)throw\"name is not a string:\"+name;return this.connected&&this.groups.delete(name)&&this.send({_:\"leave\",g:name}),this}subscribe(){this.subscribing=!0,this.connected&&this.send({_:\"sub\",opt:\"sub\",u:this.user})}unsubscribe(){this.subscribing=!1,this.connected&&this.send({_:\"sub\",opt:\"unsub\"})}requestList(){this.send({_:\"sub\",opt:\"list\"})}leaveAll(){if(this.connected)for(let g of this.groups)this.leave(g);return this}_reportOl(data){this.onOnlineChange&&this.onOnlineChange(data)}connet(addr){if(this.waiting=!1,addr&&(this.addr=addr),!1===this.on)return;if(this.opened)return;let ws=this.ws=new WebSocket(this.addr);return ws.onmessage=m=>{if(\"connected\"===m.data){ws.connected=!0;for(let g of this.groups)this.enter(g);return this.subscribing&&this.subscribe(),void(this.onConnected&&this.onConnected())}let msg=JSON.parse(m.data);switch(msg._){case\"ol\":case\"subol\":{msg.c=parseInt(msg.c,32),msg.u=parseInt(msg.u,32),this._reportOl(msg);break}default:{this.onData&&this.onData(msg);break}}},ws.onclose=()=>{if(!this.waiting){if(this.connected)for(let g of this.groups)this._reportOl({g:g,c:0,u:0});this.ws.connected=!1,this.waiting=!0,setTimeout(()=>{this.connet()},5e3)}},ws.onerror=()=>ws.onclose(),this}close(){this.on=!1,this.ws.close(),clearInterval(this.pinger)}}window.Online=Online})();\n\n},{}]},{},[1]);\n"],"file":"online.50.js"}